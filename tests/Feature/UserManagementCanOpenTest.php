<?php

namespace Tests\Feature;

use App\Models\User;
use Auth;
use Spatie\Permission\Models\Role;
use Tests\TestCase;

class UserManagementCanOpenTest extends TestCase
{
    public function test_can_go_user_page()
    {
        Auth::loginUsingId(1);

        $res = $this->get(route('admin.users.index'));

        $res->assertOk()
            ->assertSeeInOrder(['Create New User', 'ID', 'Name', 'Email', 'Role', 'Action']);
    }

    public function test_can_go_user_detail_page()
    {
        Auth::loginUsingId(1);

        $res = $this->get(route('admin.users.show', 1));

        $res->assertOk()
            ->assertSeeInOrder(['ID', 'Name', 'Email', 'Role', 'Join at', 'Action', 'Send forget password link']);
    }

    public function test_can_go_user_edit_page()
    {
        Auth::loginUsingId(1);
        $user = User::first();
        $res = $this->get(route('admin.users.edit', $user));

        $res->assertOk()
            ->assertSeeInOrder(['Name', $user->name, 'Email', $user->email, 'Role', 'Submit']);
    }

    public function test_can_go_roles_page()
    {
        Auth::loginUsingId(1);

        $res = $this->get(route('admin.roles.index'));

        $res->assertOk()
            ->assertSeeInOrder(['Create New Role', 'ID', 'Name', 'Action']);
    }

    public function test_can_go_roles_detail_page()
    {
        Auth::loginUsingId(1);
        $role = Role::first();
        $res = $this->get(route('admin.roles.show', $role));

        $res->assertOk()
            ->assertSeeInOrder(['ID', $role->id, 'Name', $role->name, 'Permissions'])
            ->assertSee($role->permissions()->get()->pluck('name')->toArray());
    }

    public function test_can_go_roles_edit_page()
    {
        Auth::loginUsingId(1);
        $role = Role::first();
        $res = $this->get(route('admin.roles.edit', $role));

        $res->assertOk()
            ->assertSeeInOrder(['Name', $role->name, 'Permissions', 'Submit']);
    }

    public function test_can_go_permissions_page()
    {
        Auth::loginUsingId(1);

        $res = $this->get(route('admin.permissions.index'));

        $res->assertOk();
    }

    public function test_can_go_permissions_detail_page()
    {
        Auth::loginUsingId(1);

        $res = $this->get(route('admin.permissions.show', 1));

        $res->assertOk();
    }
}
